<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="static/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <img class="logo" src="static/logo.png" alt="logo">
</head>

<body>
    {% include 'header.html' %}
    <h1 style="color: green;">Recommended Recipes</h1>

    <a href="/add_to_completed" class="finished-button"> FinFav</a>
    <a href="/pantry" class="back-button">Pantry</a>
    <a href = "/add_to_wishlist" class = "wishlist-button">Wishlist</a>
    <a href = "/profile_page" class = "profile-button">Profile</a>
    <a href = "/groceries" class = "profile-button">Groceries</a>

    <button class="filter-button" onclick="document.getElementById('filterModal').style.display='block'">Filter</button>
    
    <div id="filterModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('filterModal').style.display='none'">&times;</span>
            <h2>Filter Options</h2>
            
            <form action="/all_recipes" method="get">
                <label for="skill">Skill Level:</label>
                <select name="skill" id="skill">
                    <option value="">--Select--</option> 
                    <option value="Easy">Beginner</option>
                    <option value="More effort">Intermediate</option>
                    <option value="A challenge">Advanced</option>
                </select>
                <br></br>
                <label for="time">Time (minutes):</label>
                <input type="number" id="time" name="time" min="0" placeholder="Enter max time">
                <br></br>
                <button type="submit">Apply Filters</button>
            </form>
        </div>
    </div>

    <div class="recipes-container">
        {% for recipe in recipes %}
        <span class="inline-box">
            <a href="javascript:void(0);" onclick="openModal('modal{{ loop.index }}')">{{ recipe.title | safe }}</a>

            <br></br>
            <img src="{{recipe.picture_url}}" width="150" height="150">
            <br></br>
            {% if recipe.servings != "" and recipe.servings == recipe.servings %}
                Number of Servings: {{ recipe.servings }}
                <br></br>
            {% elif recipe.makes != "" and recipe.makes == recipe.makes %}
                Makes: {{ recipe.makes }}
                <br></br>
            {% endif %}
            {% if recipe.difficulty in ['Easy', 'More effort', 'A challenge'] %}
                Difficulty: {{ recipe.difficulty }}
                <br></br>
            {% else %}
            {% endif %}
            Time needed: {{recipe.prep_time[5:]}}
            <br></br>
            {% if recommended %}
                {% if recipe.missing_count == 0 %}
                Perfect Match!
                {% else %}
                # Missing Ingredients: {{recipe.missing_count}}
                {% endif %}
             <br></br>
            {% endif %}

            Tags: 
            {% for tag in recipe.restrictions %}
                <button class="tight-wrap-button">{{tag}}</button>
            {% endfor %}
            <br></br>
            <form id="wishlistForm" onsubmit="addToWishlist(event)" method="post">
                <input type="hidden" name="recipe_id" value="{{ recipe._id }}">
                <button type="submit">Add to Wishlist</button>
            </form>
        </span>
        

        <div id="modal{{ loop.index }}" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('modal{{ loop.index }}')">&times;</span>
                <h2><a href="/recipe_page?recipe={{recipe._id}}">{{recipe.title | safe}}</a></h2>
                <img src="{{ recipe.picture_url }}" width="500" height="400" style="display: block; margin: auto;">
                {% if recipe.servings != "" and recipe.servings == recipe.servings %}
                <h3>Number of Servings: {{ recipe.servings }}</h3>
                {% elif recipe.makes != "" and recipe.makes == recipe.makes %}
                <h3>Makes: {{ recipe.makes }}</h3>
                {% endif %}
                <h3>Tags:</h3>
                <div>
                    {% for tag in recipe.restrictions %}
                        <button class="tight-wrap-button">{{ tag }}</button>
                    {% endfor %}
                </div>
                <h3>Time needed: {{ recipe.prep_time[5:] }}</h3>
                <h3>Difficulty: {{ recipe.difficulty }}</h3>
                <h3>Ingredient List</h3>
                <ul>
                    {% for ingredient in recipe.actual_ingredients %}
                        <li>{{ ingredient }}</li>
                    {% endfor %}
                </ul>
                <h3>Methods</h3>
                <ol>
                    {% for method in recipe.methods %}
                        <li>{{method}}</li>
                    {% endfor %}
                </ol>
            
                <div class="bottom-buttons-container">
                    <button type="recipe" onclick="closeModal('modal{{ loop.index }}')">Not Interested</button>
                
                    <form action="/add_to_completed" method="post">
                        <input type="hidden" name="recipe_id" value="{{ recipe._id }}">
                        <button type="submit">Completed!!</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <script>
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function addToWishlist(event) {
            event.preventDefault(); 

            const form = event.target;
            const formData = new FormData(form);

            const request = new XMLHttpRequest();
            request.open("POST", "/add_to_wishlist", true);

            request.onload = function() {
                if (request.status === 200) {
                    alert("Recipe added to your wishlist!");
                } else {
                    alert("Failed to add recipe to wishlist. Please try again.");
                }
            };

            request.onerror = function() {
                alert("An error occurred. Please check your network connection.");
            };

            request.send(formData);
        }
    </script>
</body>
</html>
    
           